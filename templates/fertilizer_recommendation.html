{% extends "base.html" %}

{% block title %}Fertilizer Recommendation - Farmer's Assistant{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h2 class="text-center mb-4">
            <i class="fas fa-flask text-success"></i> Fertilizer Recommendation Tool
        </h2>
        <p class="text-center text-muted mb-5">
            Get optimal fertilizer recommendations for your crops
        </p>
    </div>
</div>

<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">
                    <i class="fas fa-seedling"></i> Enter Your Crop Details
                </h5>
            </div>
            <div class="card-body">
                <form id="fertilizerForm">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="crop_year" class="form-label">
                                <i class="fas fa-calendar"></i> Crop Year
                            </label>
                            <input type="number" class="form-control" id="crop_year" name="crop_year" 
                                   placeholder="Enter current year" min="2020" max="2030" value="2024" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="area" class="form-label">
                                <i class="fas fa-map"></i> Area (Hectares)
                            </label>
                            <input type="number" class="form-control" id="area" name="area" 
                                   placeholder="Enter field area" step="0.1" min="0.1" required>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="annual_rainfall" class="form-label">
                                <i class="fas fa-cloud-rain"></i> Annual Rainfall
                            </label>
                            <input type="number" class="form-control" id="annual_rainfall" name="annual_rainfall" 
                                   placeholder="Enter annual rainfall (mm)" step="0.1" min="0" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="n_content" class="form-label">
                                <i class="fas fa-atom"></i> Nitrogen Content
                            </label>
                            <input type="number" class="form-control" id="n_content" name="n_content" 
                                   placeholder="Enter nitrogen content (kg/ha)" step="0.1" min="0" required>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="p_content" class="form-label">
                                <i class="fas fa-atom"></i> Phosphorus Content
                            </label>
                            <input type="number" class="form-control" id="p_content" name="p_content" 
                                   placeholder="Enter phosphorus content (kg/ha)" step="0.1" min="0" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="k_content" class="form-label">
                                <i class="fas fa-atom"></i> Potassium Content
                            </label>
                            <input type="number" class="form-control" id="k_content" name="k_content" 
                                   placeholder="Enter potassium content (kg/ha)" step="0.1" min="0" required>
                        </div>
                    </div>
                    
                    <div class="text-center">
                        <button type="submit" class="btn btn-success btn-lg">
                            <i class="fas fa-calculator"></i> Get Fertilizer Recommendation
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4" id="results" style="display: none;">
    <div class="col-12">
        <div class="card result-card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-chart-bar"></i> Fertilizer Recommendation Results
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-12">
                        <h6 class="text-success">Fertilizer Recommendation:</h6>
                        <h3 id="fertilizerRec" class="text-success fw-bold"></h3>
                        <p class="text-muted">Kilo grams per hectare</p>
                    </div>
                </div>
                
                <div class="alert alert-info mt-3">
                    <h6><i class="fas fa-lightbulb"></i> Usage Tips:</h6>
                    <ul class="mb-0">
                        <li>Apply fertilizer during early morning or late evening</li>
                        <li>Water the field before and after fertilizer application</li>
                        <li>Store fertilizers in a cool, dry place</li>
                        <li>Follow local agricultural department guidelines</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.getElementById('fertilizerForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        showLoading();
        
        const formData = {
            crop_year: document.getElementById('crop_year').value,
            area: document.getElementById('area').value,
            annual_rainfall: document.getElementById('annual_rainfall').value,
            nitrogen: document.getElementById('n_content').value,
            phosphorus: document.getElementById('p_content').value,
            potassium: document.getElementById('k_content').value
        };
        
        try {
            const response = await fetch('/predict_fertilizer', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            });
            
            const result = await response.json();
            
            if (result.error) {
                showAlert(result.error, 'danger');
            } else {
                // Display results
                document.getElementById('fertilizerRec').textContent = result.fertilizer_recommendation;
                
                document.getElementById('results').style.display = 'block';
                showAlert('Fertilizer recommendation generated successfully!', 'success');
            }
        } catch (error) {
            showAlert('Error generating recommendation. Please try again.', 'danger');
        }
        
        hideLoading();
    });
</script>
{% endblock %}